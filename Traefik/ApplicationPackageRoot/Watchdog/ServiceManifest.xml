<?xml version="1.0" encoding="utf-8"?>
<ServiceManifest Name="Watchdog" Version="1.0.0" xmlns="http://schemas.microsoft.com/2011/01/fabric" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <ServiceTypes>
        <StatelessServiceType ServiceTypeName="Watchdog" UseImplicitHost="true">
            <Extensions>
                <Extension Name="Traefik">
                    <Labels xmlns="http://schemas.microsoft.com/2015/03/fabact-no-schema">
                        <Label Key="traefik.enable">true</Label>
                        <Label Key="traefik.backend.loadbalancer.stickiness">true</Label>
                        <Label Key="traefik.frontend.rule.routecheck">PathPrefix: /Traefik/Watchdog</Label>
                    </Labels>
                </Extension>
            </Extensions>
        </StatelessServiceType>
    </ServiceTypes>
    <CodePackage Name="Code" Version="1.0.0">
        <EntryPoint>
            <ExeHost>
                <Program>traefik-appinsights-watchdog.bat</Program>
                <WorkingFolder>CodePackage</WorkingFolder>
                <ConsoleRedirection FileRetentionCount="2" />
            </ExeHost>
        </EntryPoint>
        <EnvironmentVariables>
            <EnvironmentVariable Name="TraefikPort" Value="19180" />
            <EnvironmentVariable Name="TraefikApiPort" Value="19188" />
            <EnvironmentVariable Name="PollIntervalSec" Value="60" />
            <EnvironmentVariable Name="AppInsightsKey" Value="__APIKEY__" />
        </EnvironmentVariables>
    </CodePackage>
    <Resources>
        <Endpoints>
            <Endpoint Name="WatchdogTestService" UriScheme="http" Port="19182" />
        </Endpoints>
    </Resources>
</ServiceManifest>
